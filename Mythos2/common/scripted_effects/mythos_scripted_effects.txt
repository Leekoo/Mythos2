add_wounded_effect = {
	if = {
		limit = { NOT = { trait = ethereal_trait } }
		add_trait = wounded
	}
}

count_aura_rank = {
	set_variable = { which = aura_rank value = 0 }
	if = {
		limit = {
			OR = {
				trait = novice_mage
				trait = eldritch_scholar
				trait = veteran_wizard
				trait = arcane_master
			}
		}
		random = {
			chance = 40
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = {
			OR = {
				trait = eldritch_scholar
				trait = veteran_wizard
				trait = arcane_master
			}
		}
		random = {
			chance = 40
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = {
			OR = {
				trait = veteran_wizard
				trait = arcane_master
			}
		}
		random = {
			chance = 40
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = { trait = arcane_master }
		random = {
			chance = 40
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = { trait = enchanter }
		random = {
			chance = 50
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = { learning = 10 }
		random = {
			chance = 20
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = { learning = 20 }
		random = {
			chance = 20
			change_variable = { which = aura_rank value = 1 }
		}
	}
	if = {
		limit = { learning = 30 }
		random = {
			chance = 20
			change_variable = { which = aura_rank value = 1 }
		}
	}
}

count_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = chaste } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = temperate } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_virtues value = 1 } }
}

count_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = lustful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = envious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_vices value = 1 } }
}

count_norse_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = brave } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = honest } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = just } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_virtues value = 1 } }
}

count_norse_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = envious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = craven } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_vices value = 1 } }
}

count_tengri_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = just } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = trusting } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_virtues value = 1 } }
}

count_tengri_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = paranoid } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = envious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = cruel } change_variable = { which = num_vices value = 1 } }
}

count_zoroastrian_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = just } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_virtues value = 1 } }
}

count_zoroastrian_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = envious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = cruel } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_vices value = 1 } }
}

count_aztec_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = brave } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = temperate } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = chaste } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = just } change_variable = { which = num_virtues value = 1 } }
}

count_aztec_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = craven } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = lustful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_vices value = 1 } }
}

count_draconic_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = brave } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = just } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = ambitious } change_variable = { which = num_virtues value = 1 } }
}

count_draconic_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = craven } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = paranoid } change_variable = { which = num_vices value = 1 } }
}

count_satanist_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = lustful } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = envious } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_virtues value = 1 } }
}

count_satanist_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = chaste } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = temperate } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_vices value = 1 } }
}

count_undead_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = wroth } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = arbitrary } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = brave } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = cruel } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = stubborn } change_variable = { which = num_virtues value = 1 } }
}

count_undead_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = temperate } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = just } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = patient } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = kind } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = craven } change_variable = { which = num_vices value = 1 } }
}

count_draconic_human_domination_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = temperate } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = charitable } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = content } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = honest } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = shy } change_variable = { which = num_virtues value = 1 } }
}

count_draconic_human_domination_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = gluttonous } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = greedy } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = ambitious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = deceitful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = gregarious } change_variable = { which = num_vices value = 1 } }
}

count_draconic_human_extermination_virtues = {
	set_variable = { which = num_virtues value = 0 }
	if = {	limit = { trait = chaste } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = humble } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = slothful } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = content } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = craven } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = shy } change_variable = { which = num_virtues value = 1 } }
	if = {	limit = { trait = trusting } change_variable = { which = num_virtues value = 1 } }
}

count_draconic_human_extermination_vices = {
	set_variable = { which = num_vices value = 0 }
	if = {	limit = { trait = lustful } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = proud } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = diligent } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = ambitious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = brave } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = gregarious } change_variable = { which = num_vices value = 1 } }
	if = {	limit = { trait = paranoid } change_variable = { which = num_vices value = 1 } }
}

count_personal_virtues = {
	if = {
		limit = {
			use_norse_vice_virtue = yes
		}
		count_norse_virtues = yes
	}
	else_if = {
		limit = {
			use_tengri_vice_virtue = yes
		}
		count_tengri_virtues = yes
	}
	else_if = {
		limit = {
			use_zoroastrian_vice_virtue = yes
		}
		count_zoroastrian_virtues = yes
	}
	else_if = {
		limit = {
			use_aztec_vice_virtue = yes
		}
		count_aztec_virtues = yes
	}
	else_if = {
		limit = {
			use_draconic_vice_virtue = yes
		}
		count_draconic_virtues = yes
	}
	else_if = {
		limit = {
			use_satanist_vice_virtue = yes
		}
		count_satanist_virtues = yes
	}
	else_if = {
		limit = {
			use_undead_vice_virtue = yes
		}
		count_undead_virtues = yes
	}
	else_if = {
		limit = {
			use_draconic_human_domination_vice_virtue = yes
		}
		count_draconic_human_domination_virtues = yes
	}
	else_if = {
		limit = {
			use_draconic_human_extermination_vice_virtue = yes
		}
		count_draconic_human_extermination_virtues = yes
	}
	else = {
		#limit = {
		#	use_christian_vice_virtue = yes
		#}
		count_virtues = yes
	}
}

count_personal_vices = {
	if = {
		limit = {
			use_norse_vice_virtue = yes
		}
		count_norse_vices = yes
	}
	else_if = {
		limit = {
			use_tengri_vice_virtue = yes
		}
		count_tengri_vices = yes
	}
	else_if = {
		limit = {
			use_zoroastrian_vice_virtue = yes
		}
		count_zoroastrian_vices = yes
	}
	else_if = {
		limit = {
			use_aztec_vice_virtue = yes
		}
		count_aztec_vices = yes
	}
	else_if = {
		limit = {
			use_draconic_vice_virtue = yes
		}
		count_draconic_vices = yes
	}
	else_if = {
		limit = {
			use_satanist_vice_virtue = yes
		}
		count_satanist_vices = yes
	}
	else_if = {
		limit = {
			use_undead_vice_virtue = yes
		}
		count_undead_vices = yes
	}
	else_if = {
		limit = {
			use_draconic_human_domination_vice_virtue = yes
		}
		count_draconic_human_domination_vices = yes
	}
	else_if = {
		limit = {
			use_draconic_human_extermination_vice_virtue = yes
		}
		count_draconic_human_extermination_vices = yes
	}
	else = {
		#limit = {
		#	use_christian_vice_virtue = yes
		#}
		count_vices = yes
	}
}

clear_vice_virtue_modifiers = {
	remove_character_modifier = virtuous_1
	remove_character_modifier = virtuous_2
	remove_character_modifier = virtuous_3
	remove_character_modifier = virtuous_4
	remove_character_modifier = virtuous_5
	remove_character_modifier = virtuous_6
	remove_character_modifier = virtuous_7
	remove_character_modifier = wicked_1
	remove_character_modifier = wicked_2
	remove_character_modifier = wicked_3
	remove_character_modifier = wicked_4
	remove_character_modifier = wicked_5
	remove_character_modifier = wicked_6
	remove_character_modifier = wicked_7
}

add_aztec_disease_symptom_effect = {
	random_list = {
		10 = {
			modifier = {
				factor = 0
				trait = headache
			}
			character_event = { id = RIP.5004 }
		}
		10 = {
			modifier = {
				factor = 0
				trait = rash
			}
			character_event = { id = RIP.5007 }
		}
		10 = {
			modifier = {
				factor = 0
				trait = malaise
			}
			character_event = { id = RIP.5010 }
		}
	}
}

update_control = {
	if = {
		limit = { is_variable_equal = { which = control value = 1 } }
		hidden_tooltip = {
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_1 } }
			add_trait = control_1
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 2 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_2 } }
			add_trait = control_2
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 3 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_3 } }
			add_trait = control_3
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 4 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_4 } }
			add_trait = control_4
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 5 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_5 } }
			add_trait = control_5
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 6 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_7
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_6 } }
			add_trait = control_6
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 7 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_8
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_7 } }
			add_trait = control_7
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 8 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_9
		}
		if = {
			limit = { NOT = { trait = control_8 } }
			add_trait = control_8
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = control value = 9 } }
		hidden_tooltip = {
			remove_trait = control_1
			remove_trait = control_2
			remove_trait = control_3
			remove_trait = control_4
			remove_trait = control_5
			remove_trait = control_6
			remove_trait = control_7
			remove_trait = control_8
		}
		if = {
			limit = { NOT = { trait = control_9 } }
			add_trait = control_9
		}
	}
}
increase_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
		}
		custom_tooltip = { text = tt_increase_control }
		hidden_tooltip = { change_variable = { which = control value = 1 } }
		if = {
			limit = { check_variable = { which = control value = 10 } }
			set_variable = { which = control value = 9 }
		}
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
increase_low_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
			check_variable = { which = control value < 5 }
		}
		custom_tooltip = { text = tt_increase_control }
		hidden_tooltip = { change_variable = { which = control value = 1 } }
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
increase_high_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
			check_variable = { which = control value > 5 }
		}
		custom_tooltip = { text = tt_increase_control }
		hidden_tooltip = { change_variable = { which = control value = 1 } }
		if = {
			limit = { check_variable = { which = control value = 10 } }
			hidden_tooltip = { set_variable = { which = control value = 9 } }
		}
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
decrease_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
		}
		custom_tooltip = { text = tt_decrease_control }
		hidden_tooltip = { change_variable = { which = control value = -1 } }
		if = {
			limit = { check_variable = { which = control value < 1 } }
			hidden_tooltip = { set_variable = { which = control value = 1 } }
		}
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
decrease_low_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
			check_variable = { which = control value < 5 }
		}
		custom_tooltip = { text = tt_decrease_control }
		hidden_tooltip = { change_variable = { which = control value = -1 } }
		if = {
			limit = { check_variable = { which = control value < 1 } }
			hidden_tooltip = { set_variable = { which = control value = 1 } }
		}
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
decrease_high_control = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
			check_variable = { which = control value > 5 }
		}
		custom_tooltip = { text = tt_decrease_control }
		hidden_tooltip = { change_variable = { which = control value = -1 } }
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}
control_restrict_range = {
	if = {
		limit = {
			OR = {
				trait = werewolf
				trait = pup
			}
		}
		if = {
			limit = { check_variable = { which = control value < 2 } }
			hidden_tooltip = { set_variable = { which = control value = 1 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 2 }
				check_variable = { which = control value < 3 }
			}
			hidden_tooltip = { set_variable = { which = control value = 2 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 3 }
				check_variable = { which = control value < 4 }
			}
			hidden_tooltip = { set_variable = { which = control value = 3 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 4 }
				check_variable = { which = control value < 5 }
			}
			hidden_tooltip = { set_variable = { which = control value = 4 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 5 }
				check_variable = { which = control value < 6 }
			}
			hidden_tooltip = { set_variable = { which = control value = 5 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 6 }
				check_variable = { which = control value < 7 }
			}
			hidden_tooltip = { set_variable = { which = control value = 6 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 7 }
				check_variable = { which = control value < 8 }
			}
			hidden_tooltip = { set_variable = { which = control value = 7 } }
		}
		else_if = {
			limit = {
				check_variable = { which = control value = 8 }
				check_variable = { which = control value < 9 }
			}
			hidden_tooltip = { set_variable = { which = control value = 8 } }
		}
		else = {
			hidden_tooltip = { set_variable = { which = control value = 9 } }
		}
		if = {
			limit = { trait = werewolf }
			update_control = yes
		}
	}
}

update_sickly_trait = {
	if = {
		limit = { trait = sickly }
		if = {
			limit = {
				trait = dragon
				trait = demi_god
				trait = mythos_giant
				trait = djinn
			}
			remove_trait = sickly
			add_trait = sickly_30
		}
		else_if = {
			limit = {
				trait = dragon
				trait = demi_god
				trait = half_giant
				trait = djinn
			}
			remove_trait = sickly
			add_trait = sickly_27
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragon
						trait = demi_god
						trait = mythos_giant
					}
					AND = {
						trait = dragon
						trait = demi_god
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_25
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragonborn
						trait = demi_god
						trait = mythos_giant
						trait = djinn
					}
					AND = {
						trait = dragon
						trait = demi_god
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_22
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragon
						trait = mythos_giant
						trait = djinn
					}
					AND = {
						trait = demi_god
						trait = mythos_giant
						trait = djinn
					}
					AND = {
						trait = dragon
						trait = demi_god
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_20
		}
		else_if = {
			limit = {
				AND = {
					trait = dragonborn
					trait = demi_god
					trait = half_giant
					trait = djinn
				}
			}
			remove_trait = sickly
			add_trait = sickly_19
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragonborn
						trait = demi_god
						trait = mythos_giant
					}
					AND = {
						trait = dragonborn
						trait = demi_god
						trait = djinn
					}
					AND = {
						trait = dragon
						trait = half_giant
						trait = djinn
					}
					AND = {
						trait = demi_god
						trait = half_giant
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_17
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragon
						trait = mythos_giant
					}
					AND = {
						trait = dragon
						trait = djinn
					}
					AND = {
						trait = demi_god
						trait = mythos_giant
					}
					AND = {
						trait = demi_god
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_15
		}
		else_if = {
			limit = {
				AND = {
					trait = dragonborn
					trait = half_giant
					trait = demi_god
				}
			}
			remove_trait = sickly
			add_trait = sickly_14
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragonborn
						trait = mythos_giant
						trait = djinn
					}
					AND = {
						trait = dragonborn
						trait = demi_god
					}
					AND = {
						trait = dragon
						trait = half_giant
					}
					AND = {
						trait = demi_god
						trait = half_giant
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_12
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = mythos_giant
						trait = djinn
					}
					AND = {
						trait = dragon
					}
					AND = {
						trait = demi_god
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_10
		}
		else_if = {
			limit = {
				AND = {
					trait = dragonborn
					trait = half_giant
					trait = djinn
				}
			}
			remove_trait = sickly
			add_trait = sickly_9
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragonborn
						trait = mythos_giant
					}
					AND = {
						trait = dragonborn
						trait = djinn
					}
					AND = {
						trait = half_giant
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_7
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = mythos_giant
					}
					AND = {
						trait = djinn
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_5
		}
		else_if = {
			limit = {
				AND = {
					trait = dragonborn
					trait = half_giant
				}
			}
			remove_trait = sickly
			add_trait = sickly_4
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						trait = dragonborn
					}
					AND = {
						trait = half_giant
					}
				}
			}
			remove_trait = sickly
			add_trait = sickly_2
		}
	}
}

remove_sickly = {
	trigger_switch = {
		on_trigger = trait
		sickly		= { remove_trait = sickly }
		sickly_2	= { remove_trait = sickly_2 }
		sickly_4	= { remove_trait = sickly_4 }
		sickly_5	= { remove_trait = sickly_5 }
		sickly_7	= { remove_trait = sickly_7 }
		sickly_9	= { remove_trait = sickly_9 }
		sickly_10	= { remove_trait = sickly_10 }
		sickly_12	= { remove_trait = sickly_12 }
		sickly_14	= { remove_trait = sickly_14 }
		sickly_15	= { remove_trait = sickly_15 }
		sickly_17	= { remove_trait = sickly_17 }
		sickly_19	= { remove_trait = sickly_19 }
		sickly_20	= { remove_trait = sickly_20 }
		sickly_22	= { remove_trait = sickly_22 }
		sickly_25	= { remove_trait = sickly_25 }
		sickly_27	= { remove_trait = sickly_27 }
		sickly_30	= { remove_trait = sickly_30 }
	}
}

add_maimed_trait_effect_without_severely_injured = {
	if = {
		limit = { NOT = { trait = ethereal_trait } }
		custom_tooltip = {
			text = maimed_effect_tooltip
			hidden_tooltip = {
				random_list = {
					10 = {
						modifier = {
							factor = 0
							has_dlc = "Reapers"
						}
						add_trait = maimed
						character_event = { id = 38281 }
					}
					15 = {
						modifier = {
							factor = 0
							OR = {
								trait = one_eyed
								trait = blinded
								NOT = { has_dlc = "Reapers" }
							}
						}
						add_trait = one_eyed
						character_event = { id = RIP.11501 }
					}
					10 = {
						modifier = {
							factor = 0
							OR = {
								trait = one_legged
								NOT = { has_dlc = "Reapers" }
							}
						}
						add_trait = one_legged
						character_event = { id = RIP.11503 }
					}
					20 = {
						modifier = {
							factor = 0
							OR = {
								trait = one_handed
								NOT = { has_dlc = "Reapers" }
							}
						}
						add_trait = one_handed
						character_event = { id = RIP.11502 }
					}
					10 = {
						modifier = {
							factor = 0
							OR = {
								trait = disfigured
								NOT = { has_dlc = "Reapers" }
							}
						}
						add_trait = disfigured
						character_event = { id = RIP.11504 }
					}
					5 = {
						modifier = {
							factor = 0
							OR = {
								trait = mangled
								NOT = { has_dlc = "Reapers" }
							}
						}
						add_trait = mangled
						character_event = { id = RIP.11505 }
					}
				}
			}
		}
	}
}

select_random_magic_ingredient_herb_effect = { # If run once, this will set a flag on ONE herbal ingredient. If run twice, it will set a second flag on another herbal ingredient...
	if = {
		limit = {
			any_artifact = {
				has_artifact_flag = selected_ingredient_1
			}
			NOT = {
				any_artifact = {
					has_artifact_flag = selected_ingredient_2
				}
			}
		}
		random_artifact = {
			limit = {
				is_ingredient_herb_trigger = yes
				NOT = { has_artifact_flag = selected_ingredient_1 }
				NOT = { has_artifact_flag = selected_ingredient_2 }
			}
			set_artifact_flag = selected_ingredient_2
		}
	}
	if = {
		limit = {
			NOT = {
				any_artifact = {
					has_artifact_flag = selected_ingredient_1
				}
			}	
		}
		random_artifact = {
			limit = {
				is_ingredient_herb_trigger = yes
				NOT = { has_artifact_flag = selected_ingredient_1 }
				NOT = { has_artifact_flag = selected_ingredient_2 }
			}
			set_artifact_flag = selected_ingredient_1
		}
	}
}

select_random_magic_ingredient_effect = { #when it doesn't matter if it's a herb/animal part/metal/liquid
	if = {
		limit = {
			has_selected_ingredient_1_trigger = yes
			has_selected_ingredient_2_trigger = no
		}
		random_artifact = {
			limit = {
				NOT = { has_artifact_flag = selected_ingredient_1 }
				NOT = { has_artifact_flag = selected_ingredient_2 }
				has_artifact_flag = ingredient
			}
			set_artifact_flag = selected_ingredient_2
		}
	}
	if = {
		limit = {
			has_selected_ingredient_1_trigger = no
			any_artifact = {
				has_artifact_flag = ingredient
			}
		}
		random_artifact = {
			limit = {
				NOT = { has_artifact_flag = selected_ingredient_1 }
				NOT = { has_artifact_flag = selected_ingredient_2 }
				has_artifact_flag = ingredient
			}
			set_artifact_flag = selected_ingredient_1
		}
	}
}

destroy_random_q1_herb_ingredient_effect = {
	random_artifact = {
		limit = {
			has_artifact_flag = ingredient
			is_ingredient_herb_trigger = yes
			quality == 1
		}
		destroy_artifact = yes
	}
}

hermetic_add_herbal_q2_ingredient_effect = {
	hidden_effect = {
		random_list = {
			25 = {
				add_artifact = ingredient_wolfsbane
			}
			25 = {
				add_artifact = ingredient_fern_flower
			}
			25 = {
				add_artifact = ingredient_moly
			}
			25 = {
				add_artifact = ingredient_lotus
			}
			25 = {
				add_artifact = ingredient_sage
			}
			25 = {
				add_artifact = ingredient_raskovnik
			}
		}
	}
}

hermetic_add_herbal_q1_ingredient_effect = {
	hidden_effect = {
		random_list = {
			50 = {
				add_artifact = ingredient_herb1
			}
			50 = {
				add_artifact = ingredient_herb2
			}
			50 = {
				add_artifact = ingredient_herb3
			}
			50 = {
				add_artifact = ingredient_herb4
			}
			50 = {
				add_artifact = ingredient_herb5
			}
			50 = {
				add_artifact = ingredient_herb6
			}
			50 = {
				add_artifact = ingredient_herb7
			}
			50 = {
				add_artifact = ingredient_herb8
			}
			50 = {
				add_artifact = ingredient_herb9
			}
			50 = {
				add_artifact = ingredient_mistletoe
			}
			50 = {
				add_artifact = ingredient_fennel
			}
			50 = {
				add_artifact = ingredient_thyme
			}
			50 = {
				add_artifact = ingredient_horehound
			}
		}
	}
}

set_necromancy_study = {
	if = {
		limit = {
			OR = {
				has_character_modifier = studying_conjuration
				has_character_modifier = studying_herbalism
				has_character_modifier = studying_alchemy
				has_character_modifier = studying_sorcery
			}
		}
		remove_character_modifier = studying_conjuration
		remove_character_modifier = studying_herbalism
		remove_character_modifier = studying_alchemy
		remove_character_modifier = studying_sorcery
		add_character_modifier = { name = studying_necromancy duration = -1 }
	}
}
# Get a random disease, slightly weighted in favor of weaker ones. Only gives contagious diseases (nothing like cancer or food poisoning
get_random_disease = {
	if = {
		limit = { has_dlc = Reapers }
		if = {
			limit = {
				NOR = {
					trait = horse
					trait = cat
					immune_to_infection = yes
					
					has_character_flag = got_bubonic_plague
					has_character_flag = got_aztec_disease
					has_character_flag = got_smallpox
					has_character_flag = got_measles
					has_character_flag = got_typhus
					has_character_flag = got_typhoid_fever
					has_character_flag = got_syphilis
					has_character_flag = got_pneumonia
					has_character_flag = got_cancer
					has_character_flag = got_rabies
					has_character_flag = got_gout
					has_character_flag = got_flu
					has_character_flag = got_dysentery
					has_character_flag = got_food_poisoning
					has_character_flag = got_zombie_plague
				}
			}
			random_list = {
				4 = {
					trigger = {
						NOR = {
							has_character_flag = immune_tuberculosis
							has_character_flag = got_tuberculosis
							trait = has_tuberculosis
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_tuberculosis
					set_character_flag = developing_illness
					character_event = { id = RIP.5015 }
				}
				4 = {
					trigger = {
						NOR = {
							has_character_flag = immune_flu
							has_character_flag = got_flu
							trait = flu
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_flu
					set_character_flag = developing_illness
					character_event = { id = RIP.5020 }
				}
				4 = {
					trigger = {
						NOR = {
							has_character_flag = immune_measles
							has_character_flag = got_measles
							trait = has_measles
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_measles
					set_character_flag = developing_illness
					character_event = { id = RIP.5018 }
				}
				3 = {
					trigger = {
						NOR = {
							has_character_flag = immune_typhoid_fever
							has_character_flag = got_typhoid_fever
							trait = has_typhoid_fever
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_typhoid_fever
					set_character_flag = developing_illness
					character_event = { id = RIP.5016 }
				}
				3 = {
					trigger = {
						NOR = {
							has_character_flag = immune_smallpox
							has_character_flag = got_smallpox
							trait = has_small_pox
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_smallpox
					set_character_flag = developing_illness
					character_event = { id = RIP.5019 }
				}
				3 = {
					trigger = {
						NOR = {
							has_character_flag = immune_syphilis
							has_character_flag = got_syphilis
							trait = syphilitic
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_syphilis
					set_character_flag = developing_illness
					character_event = { id = RIP.5027 }
				}
				2 = {
					trigger = {
						has_global_flag = aztec_arrival
						NOR = {
							has_character_flag = immune_aztec_disease
							has_character_flag = got_aztec_disease
							trait = has_aztec_disease
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_aztec_disease
					set_character_flag = developing_illness
					character_event = { id = RIP.5019 }
				}
				2 = {
					trigger = {
						NOR = {
							has_character_flag = immune_typhus
							has_character_flag = got_typhus
							trait = has_typhus
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_typhus
					set_character_flag = developing_illness
					character_event = { id = RIP.5017 }
				}
				2 = {
					trigger = {
						NOR = {
							has_character_flag = immune_dysentery
							has_character_flag = got_dysentery
							trait = dysentery
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_dysentery
					set_character_flag = developing_illness
					character_event = { id = RIP.5033 }
				}
				2 = {
					trigger = {
						NOR = {
							has_character_flag = immune_pneumonia
							has_character_flag = got_pneumonia
							trait = pneumonic
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_pneumonia
					set_character_flag = developing_illness
					character_event = { id = RIP.5026 }
				}
				1 = {
					trigger = {
						NOR = {
							has_character_flag = immune_rabies
							has_character_flag = got_rabies
							trait = rabies
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_rabies
					set_character_flag = developing_illness
					character_event = { id = RIP.5036 }
				}
				1 = {
					trigger = {
						NOR = {
							has_character_flag = immune_bubonic_plague
							has_character_flag = got_bubonic_plague
							trait = has_bubonic_plague
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_bubonic_plague
					set_character_flag = developing_illness
					character_event = { id = RIP.5012 }
				}
				1 = {
					trigger = {
						NOR = {
							has_character_flag = immune_zombie_plague
							has_character_flag = got_zombie_plague
							trait = zombie_infection
						}
					}
					clr_character_flag = disease_not_serious
					set_character_flag = got_zombie_plague
					set_character_flag = developing_illness
					character_event = { id = ZOMBIE.34 }
				}
			}
		}
	}
	else = {
		random_list = {
			4 = { add_trait = ill }
			3 = { add_trait = pneumonic }
			2 = { add_trait = syphilitic }
			1 = { add_trait = leper }
		}
	}
}

remove_scarred = {
	set_variable = { which = scarred_variable value = 0 }
	remove_trait = scarred
	remove_trait = scarred_mid
	remove_trait = scarred_high
	remove_trait = scarred_type_1
	remove_trait = scarred_type_2
	remove_trait = scarred_type_3
	remove_trait = scarred_type_4
	remove_trait = scarred_type_5
	remove_trait = scarred_type_6
	remove_trait = scarred_type_7
	remove_trait = scarred_type_8
	remove_trait = scarred_type_9
	remove_trait = scarred_type_10
}

remove_minor_injuries = {
	remove_character_modifier = black_eye
	remove_character_modifier = swollen_wrist
	remove_character_modifier = swollen_ankle
	remove_character_modifier = concussion
	remove_character_modifier = cracked_ribs
	remove_character_modifier = badly_bruised
	remove_character_modifier = sore_muscles
}

record_MR_conversion_buildings = {
	if = {
		limit = { capital_holding = { has_building = tb_dragon_tower_2 } }
		set_character_flag = get_fp_dragon_tower_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_dragon_tower_3 } }
		set_character_flag = get_fp_dragon_tower_2
	}
	if = {
		limit = { capital_holding = { has_building = tb_werewolf_lodge_2 } }
		set_character_flag = get_fp_werewolf_lodge_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_vampire_citadel_2 } }
		set_character_flag = get_fp_vampire_mansion_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_giant_shield } }
		set_character_flag = get_fp_giant_shield_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_giant_hall } }
		set_character_flag = get_fp_giant_mansion
	}
	if = {
		limit = { capital_holding = { has_building = tb_mummy_necropolis } }
		set_character_flag = get_fp_mummy_necropolis_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_djinn_caves } }
		set_character_flag = get_fp_djinni_caves_1
	}
	if = {
		limit = { capital_holding = { has_building = tb_monster_hunter_lodge } }
		set_character_flag = get_fp_monster_hunter_lodge_1
	}
}

convert_fp_buildings = {
	family_palace = {
		if = {
			limit = { PREV = { has_character_flag = get_fp_dragon_tower_1 } }
			add_building = fp_dragon_tower_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_dragon_tower_2 } }
			add_building = fp_dragon_tower_2
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_werewolf_lodge_1 } }
			add_building = fp_werewolf_lodge_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_vampire_mansion_1 } }
			add_building = fp_vampire_mansion_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_giant_shield_1 } }
			add_building = fp_giant_shield_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_giant_mansion } }
			add_building = fp_giant_mansion
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_mummy_necropolis_1 } }
			add_building = fp_mummy_necropolis_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_djinni_caves_1 } }
			add_building = fp_djinni_caves_1
		}
		if = {
			limit = { PREV = { has_character_flag = get_fp_monster_hunter_lodge_1 } }
			add_building = fp_monster_hunter_lodge_1
		}
	}
}

clear_MR_conversion_flags = {
	clr_character_flag = get_fp_dragon_tower_1
	clr_character_flag = get_fp_dragon_tower_2
	clr_character_flag = get_fp_werewolf_lodge_1
	clr_character_flag = get_fp_vampire_mansion_1
	clr_character_flag = get_fp_giant_shield_1
	clr_character_flag = get_fp_giant_mansion
	clr_character_flag = get_fp_mummy_necropolis_1
	clr_character_flag = get_fp_djinni_caves_1
	clr_character_flag = get_fp_monster_hunter_lodge_1
}

fix_local_character_religion = {
	any_province_character = {
		limit = { no_religion = yes }
		religion = PREV
	}
}

fix_local_character_culture = {
	any_province_character = {
		limit = { no_culture = yes }
		culture = PREV
	}
}

update_religion_feature_effects = { # cover combining religion features
	hidden_tooltip = {
		if = {
			limit = {
				has_religion_feature = religion_defensive
				has_religion_feature = religion_relentless
				has_religion_feature = religion_feature_zun
			}
			set_unit_modifier = {		
				garrison_size = 0.3
				levy_size = 0.5
				light_infantry_offensive = 0.1
				heavy_infantry_offensive = 0.2
				heavy_infantry_defensive = 0.2
				light_cavalry_offensive = 0.1 
				knights_offensive = 0.1 
				pikemen_offensive = 0.1 
				archers_offensive = 0.1
				horse_archers_offensive = 0.1
				camel_cavalry_offensive = 0.1
				war_elephants_offensive = 0.1
				key = "RELENTLESS_RELIGION"
			}
			set_unit_home_modifier = {
				land_morale = 0.8
				light_infantry_defensive = 0.8
				heavy_infantry_defensive = 0.8
				pikemen_defensive = 0.8
				light_cavalry_defensive = 0.8
				knights_defensive = 0.8
				archers_defensive = 0.8
				horse_archers_defensive = 0.8
				camel_cavalry_defensive = 0.8
				war_elephants_defensive = 0.8
				
				garrison_size = 0.4
				
				key = "DEF_RELIGION_HOME_TERRITORY"
			}
		}
		else_if = {
			limit = {
				has_religion_feature = religion_defensive
				OR = {
					has_religion_feature = religion_relentless
					has_religion_feature = religion_feature_tengri
				}
			}
			set_unit_modifier = {		
				garrison_size = 0.3
				levy_size = 0.2
				light_infantry_offensive = 0.1
				heavy_infantry_offensive = 0.1
				light_cavalry_offensive = 0.1 
				knights_offensive = 0.1 
				pikemen_offensive = 0.1 
				archers_offensive = 0.1
				horse_archers_offensive = 0.1
				camel_cavalry_offensive = 0.1
				war_elephants_offensive = 0.1
				key = "RELENTLESS_RELIGION"
			}
			set_unit_home_modifier = {
				land_morale = 0.8
				light_infantry_defensive = 0.8
				heavy_infantry_defensive = 0.8
				pikemen_defensive = 0.8
				light_cavalry_defensive = 0.8
				knights_defensive = 0.8
				archers_defensive = 0.8
				horse_archers_defensive = 0.8
				camel_cavalry_defensive = 0.8
				war_elephants_defensive = 0.8
				
				garrison_size = 0.4
				
				key = "DEF_RELIGION_HOME_TERRITORY"
			}
		}
		else_if = {
			limit = {
				has_religion_feature = religion_defensive
				has_religion_feature = religion_feature_zun
			}
			set_unit_modifier = {		
				garrison_size = 0.3
				levy_size = 0.5
				
				heavy_infantry_offensive = 0.2
				heavy_infantry_defensive = 0.2
				
				key = "OFF_RELIGION"
			}
			set_unit_home_modifier = {
				land_morale = 0.8
				light_infantry_defensive = 0.8
				heavy_infantry_defensive = 0.8
				pikemen_defensive = 0.8
				light_cavalry_defensive = 0.8
				knights_defensive = 0.8
				archers_defensive = 0.8
				horse_archers_defensive = 0.8
				camel_cavalry_defensive = 0.8
				war_elephants_defensive = 0.8
				
				garrison_size = 0.4
				
				key = "DEF_RELIGION_HOME_TERRITORY"
			}
		}
		else_if = {
			limit = {
				has_religion_feature = religion_relentless
				has_religion_feature = religion_feature_zun
			}
			set_unit_modifier = { 
				light_infantry_offensive = 0.1
				heavy_infantry_offensive = 0.3
				heavy_infantry_defensive = 0.2
				light_cavalry_offensive = 0.1 
				knights_offensive = 0.1 
				pikemen_offensive = 0.1 
				archers_offensive = 0.1
				horse_archers_offensive = 0.1
				camel_cavalry_offensive = 0.1
				war_elephants_offensive = 0.1
				key = "RELENTLESS_RELIGION"
			}
		}
	}
}

calculate_hunger_gain = {
	# Base of 10
	set_variable = { which = hunger_gain value = 10 }
	set_variable = { which = hunger_gain_injuries value = 0 }
	set_variable = { which = hunger_gain_vile_blood value = 0 }
	# Slightly slower for vassal AI
	if = {
		limit = {
			ai = yes
			independent = no
		}
		subtract_variable = { which = hunger_gain value = 2 }
	}
	if = {
		limit = { trait = temperate }
		subtract_variable = { which = hunger_gain value = 5 }
	}
	else_if = {
		limit = { trait = gluttonous }
		change_variable = { which = hunger_gain value = 5 }
	}
	if = {
		limit = { trait = vomiting }
		change_variable = { which = hunger_gain value = 5 }
	}
	if = {
		limit = { has_character_modifier = vampire_starving }
		change_variable = { which = hunger_gain value = 20 }
	}
	# Age affects hunger - starting at 100, -1 per 50 years, up to -4
	if = {
		limit = { age = 100 }
		change_variable = { which = hunger_gain value = -1 }
	}
	if = {
		limit = { age = 150 }
		change_variable = { which = hunger_gain value = -1 }
	}
	if = {
		limit = { age = 200 }
		change_variable = { which = hunger_gain value = -1 }
	}
	if = {
		limit = { age = 250 }
		change_variable = { which = hunger_gain value = -1 }
	}
	# Increased hunger from injuries - 3 for major injuries, 2 for standard injuries, 1 for minor injuries
	# Major - Severely Injured, Mangled, Disfigured
	# Standard - Maimed, One-Eyed, One-Handed, One-Legged, Blinded, Eunuch
	# Minor - Wounded, Scarred, Grievously Scarred, Horrifically Scarred, badly_bruised, black_eye, swollen_ankle, swollen_wrist, sore_muscles, cracked_ribs, concussion
	if = {
		limit = { trait = severely_injured }
		change_variable = { which = hunger_gain value = 3 }
		change_variable = { which = hunger_gain_injuries value = 3 }
	}
	if = {
		limit = { trait = mangled }
		change_variable = { which = hunger_gain value = 3 }
		change_variable = { which = hunger_gain_injuries value = 3 }
	}
	if = {
		limit = { trait = disfigured }
		change_variable = { which = hunger_gain value = 3 }
		change_variable = { which = hunger_gain_injuries value = 3 }
	}
	if = {
		limit = { trait = maimed }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = one_eyed }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = one_handed }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = one_legged }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = blinded }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = eunuch }
		change_variable = { which = hunger_gain value = 2 }
		change_variable = { which = hunger_gain_injuries value = 2 }
	}
	if = {
		limit = { trait = wounded }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { trait = scarred }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { trait = scarred_mid }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { trait = scarred_high }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = badly_bruised }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = black_eye }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = swollen_ankle }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = swollen_wrist }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = sore_muscles }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = cracked_ribs }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = { has_character_modifier = concussion }
		change_variable = { which = hunger_gain value = 1 }
		change_variable = { which = hunger_gain_injuries value = 1 }
	}
	if = {
		limit = {
			trait = has_aztec_disease
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_typhus
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = cancer
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_tuberculosis
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = dancing_plague
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = dysentery
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = flu
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = food_poisoning
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = gout
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = syphilitic
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_typhoid_fever
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = ill
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = leper
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_measles
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = pneumonic
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = rabies
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = scurvy
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_small_pox
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	if = {
		limit = {
			trait = has_bubonic_plague
			any_owned_bloodline = { has_blooodline_flag = vampire_disease_hunger }
		}
		change_variable = { which = hunger_gain value = -1 }
		change_variable = { which = hunger_gain_vile_blood value = -1 }
	}
	# Minimum 1
	if = {
		limit = {
			NOT = { check_variable = { which = hunger_gain value = 1 } }
		}
		set_variable = { which = hunger_gain value = 1 }
	}
}

clear_hunger_trait = {
	set_variable = { which = hunger_progress  value = 0 }
	remove_character_modifier = vampire_starving
	if = {
		limit = { trait = hunger_1 }
		remove_trait = hunger_1
		if = {
			limit = { trait = vampire }
			add_trait = hunger_0
		}
	}
	else_if = {
		limit = { trait = hunger_2 }
		remove_trait = hunger_2
		if = {
			limit = { trait = vampire }
			add_trait = hunger_0
		}
	}
	else_if = {
		limit = { trait = hunger_3 }
		remove_trait = hunger_3
		if = {
			limit = { trait = vampire }
			add_trait = hunger_0
		}
	}
	else_if = {
		limit = { trait = hunger_4 }
		remove_trait = hunger_4
		if = {
			limit = { trait = vampire }
			add_trait = hunger_0
		}
	}
	else_if = {
		limit = { trait = hunger_5 }
		remove_trait = hunger_5
		if = {
			limit = { trait = vampire }
			add_trait = hunger_0
		}
	}
}

upgrade_hunger_trait = {
	hidden_tooltip = { subtract_variable = { which = hunger_progress value = 100 } }
	if = {
		limit = { trait = hunger_0 }
		hidden_tooltip = { remove_trait = hunger_0 }
		add_trait = hunger_1
	}
	if = {
		limit = { trait = hunger_1 }
		hidden_tooltip = { remove_trait = hunger_1 }
		add_trait = hunger_2
	}
	else_if = {
		limit = { trait = hunger_2 }
		hidden_tooltip = { remove_trait = hunger_2 }
		add_trait = hunger_3
	}
	else_if = {
		limit = { trait = hunger_3 }
		hidden_tooltip = { remove_trait = hunger_3 }
		add_trait = hunger_4
	}
	else_if = {
		limit = { trait = hunger_4 }
		hidden_tooltip = { remove_trait = hunger_4 }
		add_trait = hunger_5
	}
	# Don't check for 5 here, check in previous event to call the automatic feeding
	#else_if = {
	#	limit = { trait = hunger_5 }
	#	# Fails if imprisoned
	#	if = {
	#		limit = { is_inaccessible_or_incapable_trigger = no }
	#		# Automatic high-risk feeding
	#		random_courtier = {
	#			limit = {
	#				NOT = { trait = known_vampire }
	#			}
	#			character_event = { id = VAMPIRE.28 }
	#		}
	#	}
	#}
}
	
